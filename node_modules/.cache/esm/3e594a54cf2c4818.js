let User,multer,path,fs;_cf2‍.x([["default",()=>_cf2‍.o]]);_cf2‍.w("../model/User",[["default",["User"],function(v){User=v}]]);_cf2‍.w("multer",[["default",["multer"],function(v){multer=v}]]);_cf2‍.w("path",[["default",["path"],function(v){path=v}]]);_cf2‍.w("fs",[["default",["fs"],function(v){fs=v}]]);





const storage = multer.diskStorage({
  destination: (req,file,cb) => cb(null, 'uploads/'),
  filename: (req, file, cb) => {
    cb(null, Date.now() + "-" + file.originalname)
  },
    
    });
    // const filetype = multer({

    //   fileFilter: (req, file, cb) => {
    //         if (file.mimetype === "pdf" ) {
    //           cb(null, true);
    //         } else {
    //           cb(null, false);
    //           return cb(new Error('Only .png, .jpg and .jpeg format allowed!'));
    //         }
    //       }

    // })
  

    // cb(null, Date.now() + "-" + file.originalname)
const handleMultipartData = multer({ storage, limit: {filesize : 1000000 * 5 }}).single('resume');
const userController = {

    async apply(req, res) {
            handleMultipartData(req,res, async (err) => {

                const { name, email, phone, linkedin, resume, reference } = req.body;
                const filePath = req.file.path;
                  _cf2‍.g.console.log(filePath)
                  let document;
                try{
                   document = await User.create({
                    name,
                    email,
                    phone,
                    linkedin, 
                    resume: filePath,
                    reference

                });
                      _cf2‍.g.console.log(document);
                  }
                  catch(err){
                     _cf2‍.g.console.log(err)
                  }
                  res.status(201).json({
                      success:true,
                      data: document
                  }); 
              });
         
            },
            async index(req, res) {
              const userdata = await User.find(
              );
               res.status(201).json(userdata);
             
            },
            async download(req,res){
              let records;
              try{
                    records= await User.findById( req.query.id );

                   }
              catch(error){
                _cf2‍.g.console.log(error)
              }
              //res.json(records)
              _cf2‍.g.console.log
             res.download(records.resume)
             // res.download(`./${records.resume}`);
          
            }

           
                     
}
_cf2‍.d(userController);